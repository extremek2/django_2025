<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>Title</title>
  <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
</head>
<body>
  <script>
    // CSRF 토큰 가져오기 함수
    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                // 쿠키 이름 찾기
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }
    const csrftoken = getCookie('csrftoken');

    $(document).ready(function (){
      getPostList();
    });

    function getPostList(){
      $('#postList').empty();
      $.ajax(
        { url: "{% url 'blogAPI' %}",
          type: "GET",
          success: function(data){
            console.log(data);
            let list = data;
            $(list).each(function(){
              console.log(this);
              console.log("=====");
              let str ='';
              str += '<hr>';
              str += '<div>';
              str += this.title + " ==== ";
              str += this.author + " ==== ";
              str += this.content + " ==== ";
              str += '</div>';
              $('#postList').append(str)
            });
            alert("전체글 성공");
          },
          error: function(){
            alert("전체글 실패");
          }
        }
      )
    }
    $(document).ready(function (){
      $('#postAddBtn').click(function(){
        const post = {
          title : $('#title').val(),
          author : $('#author').val(),
          content : $('#content').val()
        };
        $.ajax({
          url : "{% url 'blogAPI' %}",
          type : "POST",
          contentType : "application/json",
          data : JSON.stringify(post),
          headers : {'X-CSRFToken': csrftoken},
          success : function(data){
            console.log(data);
            $('#title').val('');
            $('#author').val('');
            $('#content').val('');
            alert("새 글 성공");
            getPostList();
          },
          error : function(data){
            console.log(data);
            alert("새 글 작성 실패");
          }
        });
      });
    });

  </script>

  <h3>새글 작성</h3>
  작성 화면, 버튼

  <form id="postform">
    <input type="text" id="title" placeholder="title" required><br>
    <input type="text" id="author" placeholder="author" required><br>
    <input type="text" id="content" placeholder="content" required><br>
    <input type="button" id="postAddBtn" value="새글 작성하기">
  </form>

  <div id="result"></div>


  <h1>글 목록입니다.</h1>
  <div id="postList"></div>


</body>

</html>